variables:
  - name: AKS_CLUSTER_NAME
    value: $(aks_cluster_name)
  - name: RESOURCE_GROUP_NAME
    value: $(aks_resource_group_name)
  - name: K8S_SERVICE_CONN
    value: $(k8s_service_connection_name)

stages:
  - stage: Deploy
    jobs:
      - job: DeployToAKS
        pool:
          vmImage: ubuntu-latest
        steps:
          - task: Kubernetes@1
            displayName: 'kubectl apply to AKS'
            inputs:
              connectionType: 'Azure Resource Manager'
              azureSubscriptionEndpoint: $(K8S_SERVICE_CONN)
              azureResourceGroup: $(RESOURCE_GROUP_NAME)
              kubernetesCluster: $(AKS_CLUSTER_NAME)
              command: apply
              useConfigurationFile: true
              configuration: |
                manifests/deployment.yaml
